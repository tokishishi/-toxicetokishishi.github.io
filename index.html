<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>抽獎網站</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/earlyaccess/cwtexyen.css");
      body {
        font-family: "cwTeXYen", sans-serif;
        background-color: #fae49c;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }

      .container {
        text-align: center;
      }
      h1 {
        color: red;
      }

      .first {
        width: 80vw;
        height: auto;
      }
      .first.show {
        height: 800px;
        width: 600px;
      }
      img {
        height: 100%;
        width: 100%;
        object-fit: contain;
      }
      .showimage {
        z-index: 2;
        max-height: 100vh;
        width: auto;
      }

      .d-none {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="first_text">草みくじ心誠則靈</h1>
      <figure class="first" id="showBox">
        <img src="00.png" class="" id="lotteryimage" alt="" />
        <img src="" class="d-none showimage" id="showimage" alt="" />
      </figure>
      <h3 class="d-none" id="result-text"></h3>
    </div>

    <script>
      let firstCheck = true;
      function startLottery() {
        if (firstCheck) {
          $("#lotteryimage").addClass("animate__animated animate__shakeY");
          const randomImgIndex = Math.floor(Math.random() * images.length);
          let randomImage = images[randomImgIndex];
          setTimeout(() => {
            $("#first_text").addClass("d-none");
            $("#lotteryimage").addClass("d-none");
            $("#showimage").removeClass("d-none");
            if (!!localStorage.getItem("tokishishi")) {
              randomImage = localStorage.getItem("tokishishi");
            }
            $("#showimage").attr("src", `/image/${randomImage}`);
            $("#showimage").addClass("animate__animated animate__backInDown");

            // 使用事件監聽器來在動畫結束後移除動畫類，以便再次觸發
            $("#showimage").one(
              "webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",
              function () {
                $(this).removeClass("animate__animated animate__backInDown");
              }
            );
            localStorage.setItem("tokishishi", randomImage);
          }, 800);
          firstCheck = false;
        }
      }

      const images = [
        "image1.png",
        "image2.png",
        "image3.png",
        "image4.png",
        "image5.png",
        "image6.png",
        "image7.png",
        "image8.png",
        "image9.png",
        "image10.png",
        "image11.png",
        "image12.png",
        "image13.png",
        "image14.png",
        "image15.png",
        "image16.png",
      ];
      const doFirst = async () => {
        $(".container").on("click", () => {
          startLottery();
        });
      };
      $(document).ready(function () {
        doFirst();
      });
    </script>
  </body>
</html>
